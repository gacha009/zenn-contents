---
title: "ãƒãƒ¼ãƒ‰ã®è¦ªå­é–¢ä¿‚ã‚’è§£é™¤ã™ã‚‹ã¨ãã«outlinerã®ä¸¦ã³é †ã‚’å£Šã•ãªã„æ–¹æ³•"
emoji: "ğŸ”°"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Maya]
published: false
---

# æ¦‚è¦
æœ€è¿‘ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒŠãƒ¼ã§è¦ªå­é–¢ä¿‚ã‚’è§£é™¤ã™ã‚‹ã¨ã€ä¸¦ã³é †ãŒé™é †ã«ä»£ã‚ã£ã¦ã—ã¾ã†ã“ã¨ãŒå¤šãã€
ãªã‚“ã ã‹ãªã¨ã„ã†æ°—æŒã¡ã«ãªã‚‹äº‹ãŒå¤šã„ã®ã§ã€ã“ã®æ©Ÿã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã£ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚
ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒŠãƒ¼ã ã¨ã€è¡¨ç¤ºçŠ¶æ…‹ã«ã‚ˆã£ã¦è¦ªå­é–¢ä¿‚ã‚’è§£é™¤ã™ã‚‹ã“ã¨ãŒé›£ã—ã„ã“ã¨ã‚‚ã‚ã‚‹ã®ã§ã€
ãã†ã„ã†ç…©ã‚ã—ã•ã‚‚åŒæ™‚ã«è§£æ±ºã§ãã‚‹ã‹ãªã¨æ€ã„ã¾ã™ã€‚

# ã¯ã˜ã‚ã«
è‰²ã€…èª¿ã¹ã¦ã„ãŸã‚‰ã€Maya Advent Callender 2022ã§@9boz(kubo)ã•ã‚“ãŒè¨˜äº‹ã‚’2ã¤æ›¸ã‹ã‚Œã¦ã„ãŸã®ã§ã€
ãã‚Œã‚’å¿œç”¨ã•ã›ã¦ã‚‚ã‚‰ã„ãªãŒã‚‰è¨­è¨ˆã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

https://qiita.com/9boz/items/c78177d5d537c4ff1cca


# è¨­è¨ˆ
ã‚„ã‚ŠãŸã„ã“ã¨ã‚’æ•´ç†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®2ã¤ã«ã‚ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ãƒ»è¦ªå­é–¢ä¿‚ã‚’è§£é™¤ã—ã¦ä¸¦åˆ—åŒ–ã™ã‚‹
ãƒ»ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒŠãƒ¼ã§è¦ªã ã£ãŸãƒãƒ¼ãƒ‰ã®ä¸‹ã«æ˜‡é †ã«é…ç½®ã™ã‚‹

ãã—ã¦ã€ã“ã‚Œã‚‰ã‚’æ‰‹é †ã«åˆ†è§£ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
1. è¦ªãƒãƒ¼ãƒ‰ã®æ›´ã«è¦ªã®ãƒãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹
2. è¦ªãƒãƒ¼ãƒ‰ãŒéšå±¤å†…ã§ã©ã®é †ä½ã«ã„ã‚‹ã‹ã‚’å–å¾—ã™ã‚‹
3. è¦ªã‚’2.ã§å–å¾—ã—ãŸãƒãƒ¼ãƒ‰ã«å¤‰æ›´ã™ã‚‹
4. reorderã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒŠãƒ¼ã®é †ç•ªã‚’å…¥ã‚Œæ›¿ãˆã‚‹

ã“ã®æ‰‹é †ã«æ²¿ã£ã¦ã€ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚



# 1. è¦ªãƒãƒ¼ãƒ‰ã®æ›´ã«è¦ªã®ãƒãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹
è¦ªå­é–¢ä¿‚ã‚’è§£æ¶ˆã—ãŸã„ã¨ã„ã†ã“ã¨ã¯ã€2ã¤ä¸Šã®éšå±¤ã«è¦ªã‚’å¤‰æ›´ã™ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚
ã¤ã¾ã‚Šã€è¦ªãƒãƒ¼ãƒ‰ã®è¦ªãƒãƒ¼ãƒ‰ãŒæ–°ã—ã„è¦ªã¨ã„ã†ã“ã¨ã§.....æ—¥æœ¬èªé›£ã—ã„ã§ã™ã­ï½—

ãã†ã„ãˆã°ã€å¯¾è±¡ã¨ã™ã‚‹ãƒãƒ¼ãƒ‰ã«ã¤ã„ã¦ã€è¨­è¨ˆã®æ™‚ç‚¹ã§æ˜ç¢ºåŒ–ã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚
ä¸€å…ˆãšã¯ã€ã€é¸æŠã—ã¦ã„ã‚‹å­ãƒãƒ¼ãƒ‰(è¤‡æ•°å¯)ã§ã€è¦ªã¯å…±é€šã€‘ã¨ã—ã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚
```py:
# å¯¾è±¡ãƒãƒ¼ãƒ‰ã‚’å–å¾—
targets = cmds.ls(sl=True)
# ç¾åœ¨ã®è¦ªãƒãƒ¼ãƒ‰ã‚’å–å¾—
parent = cmds.listRelatives(target[0], parent=True)
# æ–°ã—ã„è¦ªãƒãƒ¼ãƒ‰ã‚’å–å¾—
grand_parent = cmds.listRelatives(parent[0], parent=True)


```

# 2. è¦ªãƒãƒ¼ãƒ‰ãŒéšå±¤å†…ã§ã©ã®é †ä½ã«ã„ã‚‹ã‹ã‚’å–å¾—ã™ã‚‹
ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒŠãƒ¼ã§ã®é †ç•ªã‚’æ•´ç†ã™ã‚‹ãŸã‚ã«ã¯ã€åŸºæº–ã¨ãªã‚‹é †ä½ãŒå¿…è¦ã§ã™ã€‚
ä»Šå›ã®å ´åˆã€åŸºæº–ã¨ãªã‚‹ãƒãƒ¼ãƒ‰ã¯ã€å¯¾è±¡ã®è¦ªãƒãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚
è¦ªãƒãƒ¼ãƒ‰ã®é †ä½ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã€ã¾ãšã¯ @9boz(kubo)ã•ã‚“ã®ä½œæˆã•ã‚ŒãŸ [getStartIndexé–¢æ•°](https://qiita.com/9boz/items/f5d1da09c6f7530499ac) ã‚’
å¼•æ•°(target)ã®ç¾åœ¨ã®é †ä½ã‚’å–å¾—ã™ã‚‹éƒ¨åˆ†ã¨å¼•æ•°(targets:list[str])å†…ã®ä¸€ç•ªè‹¥ã„æ•°å­—ã‚’è¿”ã™éƒ¨åˆ†ã«åˆ†å‰²ã—ã¾ã™ã€‚

```py:
def get_current_index(target:str)->int:
    """
    éšå±¤å†…ã«ãŠã‘ã‚‹targetã®é †ä½ã‚’å–å¾—ã—ã¦è¿”ã™
    """
    parent = cmds.listRelatives(target, parent=True)
    
    if parent:
        # è¦ªä»¥ä¸‹ã®transformãƒãƒ¼ãƒ‰ã‚’å–å¾—ã—ã€targetã®é †ä½ã‚’å–å¾—ã™ã‚‹
        nodes = cmds.listRelatives(parent[0], type='transform')
        index = nodes.index(target)

    else:
        # è¦ªãŒworldã®å ´åˆã¯ã€æœ€ä¸Šä½ãƒãƒ¼ãƒ‰ä¸­ã®targeté †ä½ã‚’å–å¾—ã™ã‚‹
        top_nodes = cmds.ls(assemblies=True)
        index = top_nodes.index(target)
    
    return index


def get_start_index(targets:list[str])->int:
    """
    targetsã®éšå±¤å†…ã®é †ä½ã‚’å–å¾—ã—ã¦ã€ä¸€ç•ªè‹¥ã„é †ä½ã‚’è¿”ã™
    """
    cur_index_list = []
    for target in targets:
        cur_index = get_current_index(target)
        cur_index_list.append(cur_index)
    
    # ã‚½ãƒ¼ãƒˆã—ã¦ä¸€ç•ªè‹¥ã„æ•°ã®ã¿è¿”ã™
    cur_index_list.sort()
    return cur_index_list[0]

```
ä»ŠçŸ¥ã‚ŠãŸã„ã®ã¯ã€è¦ªãƒãƒ¼ãƒ‰ã®é †ä½ãªã®ã§ã€ä¸Šè¨˜ã® get_current_indexé–¢æ•°ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
```py:
# è¦ªã®éšå±¤å†…ã§ã®é †ä½ã‚’å–å¾—ã™ã‚‹
parent_cur_index = get_current_index(target=parent[0])
```

# 3.è¦ªã‚’1.ã§å–å¾—ã—ãŸãƒãƒ¼ãƒ‰ã«å¤‰æ›´ã™ã‚‹
å¿…è¦ãªæƒ…å ±ã¯å–å¾—ã§ããŸã®ã§ã€æ¬¡ã¯éšå±¤ã‚’å¤‰æ›´ã—ã¦ä¸¦åˆ—åŒ–ã—ã¾ã™ã€‚
ã“ã“ã¯ã€è¦ªã‚’å¤‰æ›´ã™ã‚‹ã ã‘ãªã®ã§ç‰¹åˆ¥ãªã“ã¨ã¯ã—ã¾ã›ã‚“ã€‚
ãŸã ã—ã€2ã¤ä¸Šã®éšå±¤ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã€worldã‚’è¦ªã¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§åˆ†å²å‡¦ç†ã‚’ã—ã¦ãŠãã¾ã™ã€‚

```py:
for target in targets:
    if grand_parent:
       cmds.parent(target, grand_parent[0])
    else:
        cmds.parent(target, world=True)
```


# 4. reorderã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒŠãƒ¼ã®é †ç•ªã‚’å…¥ã‚Œæ›¿ãˆã‚‹
éšå±¤å†…ã®é †ä½ã‚’è¦ªã ã£ãŸãƒãƒ¼ãƒ‰ã‚’åŸºæº–ã«æ˜‡é †ã«ãªã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã¦ã„ãã¾ã™ã€‚
éšå±¤ã®é †ä½ã‚’å¤‰æ›´ã™ã‚‹ã«ã¯ã€[reorder](https://help.autodesk.com/view/MAYAUL/2024/JPN/?guid=__CommandsPython_index_html)ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
é †ä½ã®å¤‰æ›´ã¯ã€@9boz(kubo)ã•ã‚“ã®è¨˜äº‹ã‚’å‚è€ƒã«ã€ä»¥ä¸‹ã®æ–¹æ³•ã§è¡Œã„ã¾ã™ã€‚
1. è¦ªã®é †ä½(A)ã‚’åŸºæº–ã¨ã™ã‚‹
2. æ•´ç†å¯¾è±¡ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é †ç•ªã« å…ˆé ­ã«ç§»å‹• -> A + n ã«ç§»å‹•ã‚’ç¹°ã‚Šè¿”ã™

ãƒ«ãƒ¼ãƒ—å‡¦ç†ã«ãªã‚Šã¾ã™ã®ã§ã€3.ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨åˆä½“ã•ã›ã¾ã™ã€‚
ãã—ã¦ã€n ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã€forãƒ«ãƒ¼ãƒ—ã‚’enumerateç”¨æ³•ã«å¤‰æ›´ã—ã¾ã™ã€‚
Aã¯ã€2.ã§å–å¾—ã—ãŸparent_cur_indexã«ãªã‚Šã¾ã™ã€‚
```py:

# targetã®ä¸¦ã³é †ã‚’æ•´ãˆã‚‹
targets.sort()

for i, target in enumerate(targets):
    # åˆæœŸå€¤ã‚’èª¿æ•´
    n = i + 1

    # éšå±¤ã‚’å¤‰æ›´
    if grand_parent:
       cmds.parent(target, grand_parent[0])
    else:
        cmds.parent(target, world=True)

    # éšå±¤ã®é †ç•ªã‚’èª¿æ•´
    cmds.reorder(target[i], front=True) # å…ˆé ­ã«ç§»å‹•
    cmds.reorder(target[i], relative=parent_cur_index + n) # A+nã«ç§»å‹•

```
å¿µã®ãŸã‚ã€å‡¦ç†ã‚’è¡Œã†å‰ã«sort()ã§ä¸¦ã³é †ã‚’æ˜‡é †ã«æ•´ãˆã¾ã—ãŸã€‚


# é–¢æ•°åŒ–
é¸æŠã—ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ã‚’åŸºæœ¬çš„ã«ã¯å¯¾è±¡ã¨ã™ã‚‹ã¨æ€ã„ã¾ã™ãŒã€
æ±ç”¨çš„ã«ã—ã¦ãŠã„ãŸæ–¹ãŒä¾¿åˆ©ã‹ãªã¨æ€ã†ã®ã§ã€é–¢æ•°åŒ–ã—ã¾ã™ã€‚
å¯¾è±¡ã¨ã™ã‚‹ãƒãƒ¼ãƒ‰ã‚’å¼•æ•°ã«ã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«çºã‚ã¾ã—ãŸã€‚

```py:
def dissolve_parent_child_relationshop(targets:list[str])->None:
    """
    è¦ªå­é–¢ä¿‚ã‚’è§£æ¶ˆã—ã¦ã€ä¸¦åˆ—åŒ–ã™ã‚‹ã€‚å­ãƒãƒ¼ãƒ‰ã¯è¦ªã‚’åŸºæº–ã«æ˜‡é †ã«ä¸¦ã¹ã‚‹
    """
    # targetã®ä¸¦ã³é †ã‚’æ•´ãˆã‚‹
    targets.sort()
    # ç¾åœ¨ã®è¦ªãƒãƒ¼ãƒ‰ã‚’å–å¾—
    parent = cmds.listRelatives(target[0], parent=True)
    # æ–°ã—ã„è¦ªãƒãƒ¼ãƒ‰ã‚’å–å¾—
    grand_parent = cmds.listRelatives(parent[0], parent=True)

    # è¦ªã®éšå±¤å†…ã§ã®é †ä½ã‚’å–å¾—ã™ã‚‹
    parent_cur_index = get_current_index(target=parent[0])

    # main
    for i, target in enumerate(targets):
    # åˆæœŸå€¤ã‚’èª¿æ•´
    n = i + 1

    # éšå±¤ã‚’å¤‰æ›´
    if grand_parent:
       cmds.parent(target, grand_parent[0])
    else:
        cmds.parent(target, world=True)

    # éšå±¤ã®é †ç•ªã‚’èª¿æ•´
    cmds.reorder(target[i], front=True) # å…ˆé ­ã«ç§»å‹•
    cmds.reorder(target[i], relative=parent_cur_index + n) # A+nã«ç§»å‹•
```

# æœ€å¾Œã«
æ—¥å¸¸ã®ã¡ã‚‡ã£ã¨ã—ãŸä¸æº€ã‚’è§£æ¶ˆã§ãã‚‹è¨˜äº‹ã«ã—ãŸã„ãªã¨æ€ã£ã¦ã€ä»Šå›outlinerã®èª¿æ•´ã‚’æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚
outlinerã®ä¸¦ã³ã‚’èª¿æ•´ã—ãŸã„ã‚·ãƒ¼ãƒ³ã£ã¦ç§ã¯çµæ§‹ã‚ã‚‹ã®ã§ã€
ä»Šå›ä½œã£ãŸé–¢æ•°ã¨ã€ä¸Šã«ç§»å‹•ãƒ»ä¸‹ã«ç§»å‹•ãƒ»è¤‡æ•°ã‚’ä¸Šã«ç§»å‹•ãƒ»è¤‡æ•°ã‚’ä¸‹ã«ç§»å‹•ã€‚ã¿ãŸã„ãªé–¢æ•°ã‚’ä½œã£ã¦
GUIåŒ–ã—ãŸã‚‰ç…©ã‚ã—ã„ã“ã¨æ¸›ã‚‹ã‹ãªã...ã¨ã‹æ€ã„ã¾ã—ãŸã€‚
æ´¾ç”Ÿã•ã›ãŸã‚‰ã€éšå±¤ã‚’è¨˜æ†¶ã—ã¦ä¸¦ã¹æ›¿ãˆã¨ã‹ã‚‚ã§ããã†ã‹ãª...??

ä¸€åº¦ä»•çµ„ã¿ã‚’ç†è§£ã—ã¦ã—ã¾ãˆã°ãã“ã¾ã§è¤‡é›‘ã§ã¯ãªã„ã®ã§ã€ã“ã®è¨˜äº‹ãŒã¨ã£ã‹ã‹ã‚Šã«ãªã£ãŸã‚‰å¬‰ã—ã„ã§ã™ã€‚



-----
#### å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸã‚µã‚¤ãƒˆæ§˜
- https://qiita.com/9boz/items/c78177d5d537c4ff1cca
- https://qiita.com/9boz/items/f5d1da09c6f7530499ac

-----
æœ€çµ‚çš„ãªã‚³ãƒ¼ãƒ‰
:::details result code
```py:
def get_current_index(target:str)->int:
    """
    éšå±¤å†…ã«ãŠã‘ã‚‹targetã®é †ä½ã‚’å–å¾—ã—ã¦è¿”ã™
    """
    parent = cmds.listRelatives(target, parent=True)
    
    if parent:
        # è¦ªä»¥ä¸‹ã®transformãƒãƒ¼ãƒ‰ã‚’å–å¾—ã—ã€targetã®é †ä½ã‚’å–å¾—ã™ã‚‹
        nodes = cmds.listRelatives(parent[0], type='transform')
        index = nodes.index(target)

    else:
        # è¦ªãŒworldã®å ´åˆã¯ã€æœ€ä¸Šä½ãƒãƒ¼ãƒ‰ä¸­ã®targeté †ä½ã‚’å–å¾—ã™ã‚‹
        top_nodes = cmds.ls(assemblies=True)
        index = top_nodes.index(target)
    
    return index


def get_start_index(targets:list[str])->int:
    """
    targetsã®éšå±¤å†…ã®é †ä½ã‚’å–å¾—ã—ã¦ã€ä¸€ç•ªè‹¥ã„é †ä½ã‚’è¿”ã™
    """
    cur_index_list = []
    for target in targets:
        cur_index = get_current_index(target)
        cur_index_list.append(cur_index)
    
    # ã‚½ãƒ¼ãƒˆã—ã¦ä¸€ç•ªè‹¥ã„æ•°ã®ã¿è¿”ã™
    cur_index_list.sort()
    return cur_index_list[0]


def dissolve_parent_child_relationshop(targets:list[str])->None:
    """
    è¦ªå­é–¢ä¿‚ã‚’è§£æ¶ˆã—ã¦ã€ä¸¦åˆ—åŒ–ã™ã‚‹ã€‚å­ãƒãƒ¼ãƒ‰ã¯è¦ªã‚’åŸºæº–ã«æ˜‡é †ã«ä¸¦ã¹ã‚‹
    """
    # targetã®ä¸¦ã³é †ã‚’æ•´ãˆã‚‹
    targets.sort()
    # ç¾åœ¨ã®è¦ªãƒãƒ¼ãƒ‰ã‚’å–å¾—
    parent = cmds.listRelatives(target[0], parent=True)
    # æ–°ã—ã„è¦ªãƒãƒ¼ãƒ‰ã‚’å–å¾—
    grand_parent = cmds.listRelatives(parent[0], parent=True)

    # è¦ªã®éšå±¤å†…ã§ã®é †ä½ã‚’å–å¾—ã™ã‚‹
    parent_cur_index = get_current_index(target=parent[0])

# main
sels = cmds.ls(sl=True, type='transform')
dissolve_parent_child_relationshop(targets=sels)

```
:::